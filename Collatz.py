#!/usr/bin/env python3

# ---------------------------
# projects/collatz/Collatz.py
# Copyright (C) 2016
# Glenn P. Downing
# ---------------------------

# ------------
# collatz_read
# ------------


def collatz_read(s):
    """
    read two ints
    s a string
    return a list of two ints, representing the beginning and end of a range, [i, j]
    """
    a = s.split()
    return [int(a[0]), int(a[1])]

# ------------
# collatz_eval
# ------------


def collatz_eval(i, j):
    """
    i the beginning of the range, inclusive
    j the end       of the range, inclusive
    return the max cycle length of the range [i, j]
    """
    try:
        assert i>0
        assert j>0
    except:
        return ""

    cacheEvens = [2**n for n in range(1,32)]
    cachePrime = [3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199]
    cachePrimeSol = [8, 6, 17, 15, 10, 13, 21, 16, 19, 107, 22, 110, 30, 105, 12, 33, 20, 28, 103, 116, 36, 111, 31, 119, 26, 88, 101, 114, 13, 47, 29, 91, 42, 24, 16, 37, 24, 68, 32, 32, 19, 45, 120, 27, 120]

    cache120 = [129, 171, 231, 235, 257, 258, 259, 265, 313, 327, 342, 343, 345, 347, 353, 386, 387, 388, 389, 390, 391, 398, 399, 411, 415, 417, 457, 459, 462, 463, 470, 471, 487, 491, 514, 515, 516, 517, 518, 521, 523, 530, 531, 543, 553, 609, 617, 619, 623, 626, 627, 639, 649, 654, 655, 667, 684, 685, 686, 689, 690, 691, 694, 695, 697, 703, 706, 707, 731, 737, 751, 763, 772, 773, 774, 775, 776, 778, 780, 781, 782, 783, 785, 796, 797, 798, 811, 815, 822, 823, 825, 830, 831, 834, 835, 859, 865, 871, 873, 879, 889, 913, 914, 915, 918, 919, 921, 924, 925, 926, 929, 935, 937, 940, 941, 942, 959, 967, 974, 975, 982, 983, 1001, 1017, 1028, 1029, 1030, 1032, 1033, 1034, 1035, 1036, 1037, 1041, 1042, 1043, 1046, 1047, 1055, 1060, 1061, 1062, 1071, 1081, 1083, 1086, 1087, 1097, 1106, 1107, 1113, 1127, 1145, 1153, 1161, 1163, 1185, 1215, 1217, 1218, 1219, 1223, 1225, 1227, 1233, 1234, 1235, 1238, 1239, 1246, 1247, 1249, 1252, 1253, 1254, 1263, 1278, 1279, 1287, 1289, 1298, 1299, 1307, 1308, 1309, 1310, 1319, 1334, 1335, 1351, 1368, 1370, 1372, 1373, 1377, 1378, 1379, 1380, 1381, 1382, 1388, 1389, 1390, 1394, 1395, 1403, 1406, 1407, 1412, 1413, 1414, 1419, 1439, 1441, 1449, 1451, 1455, 1462, 1463, 1467, 1471, 1474, 1475, 1483, 1502, 1503, 1515, 1519, 1526, 1527, 1537, 1544, 1546, 1548, 1549, 1550, 1551, 1552, 1553, 1556, 1557, 1560, 1562, 1563, 1564, 1565, 1566, 1570, 1571, 1579, 1583, 1592, 1593, 1594, 1596, 1597, 1607, 1622, 1623, 1625, 1630, 1631, 1633, 1644, 1645, 1646, 1647, 1650, 1651, 1660, 1661, 1662, 1665, 1668, 1669, 1670, 1675, 1691, 1695, 1705, 1707, 1711, 1718, 1719, 1730, 1731, 1742, 1743, 1745, 1746, 1747, 1758, 1759, 1767, 1778, 1779, 1801, 1819, 1823, 1826, 1827, 1828, 1829, 1830, 1835, 1836, 1837, 1838, 1839, 1841, 1842, 1843, 1848, 1850, 1851, 1852, 1853, 1858, 1859, 1870, 1871, 1874, 1875, 1880, 1882, 1884, 1885, 1895, 1903, 1915, 1918, 1919, 1921, 1931, 1934, 1935, 1948, 1949, 1950, 1951, 1961, 1964, 1965, 1966, 1977, 1979]
    cache120Sol = [122, 125, 128, 128, 123, 123, 123, 123, 131, 144, 126, 126, 126, 126, 126, 121, 121, 121, 121, 121, 121, 121, 121, 134, 134, 134, 129, 129, 129, 129, 129, 129, 142, 142, 124, 124, 124, 124, 124, 124, 124, 124, 124, 137, 137, 132, 132, 132, 132, 132, 132, 132, 145, 145, 145, 145, 127, 127, 127, 127, 127, 127, 127, 127, 127, 171, 127, 127, 140, 140, 140, 153, 122, 122, 122, 153, 122, 122, 122, 122, 122, 122, 122, 122, 122, 122, 135, 135, 135, 135, 135, 135, 135, 135, 135, 148, 148, 179, 148, 148, 148, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 174, 130, 130, 130, 130, 143, 143, 143, 143, 143, 143, 156, 125, 125, 125, 125, 156, 125, 125, 125, 125, 125, 125, 125, 125, 125, 169, 125, 125, 125, 169, 138, 138, 138, 138, 138, 138, 138, 138, 138, 151, 151, 182, 151, 151, 164, 133, 133, 133, 133, 133, 133, 133, 133, 133, 133, 133, 133, 133, 177, 133, 133, 133, 177, 133, 133, 146, 146, 146, 146, 177, 146, 146, 146, 146, 146, 146, 159, 128, 128, 128, 128, 159, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 172, 172, 128, 128, 128, 128, 128, 141, 141, 141, 141, 141, 141, 141, 172, 141, 141, 141, 141, 141, 141, 154, 154, 154, 154, 123, 123, 123, 123, 154, 154, 123, 123, 123, 123, 123, 123, 154, 123, 123, 123, 123, 123, 123, 167, 123, 123, 123, 123, 123, 167, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 180, 136, 136, 136, 136, 136, 180, 136, 149, 149, 149, 149, 149, 149, 180, 180, 149, 149, 149, 149, 149, 149, 149, 149, 162, 162, 162, 131, 131, 131, 131, 131, 131, 131, 131, 131, 162, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 175, 175, 131, 131, 131, 131, 175, 131, 175, 131, 131, 144, 144, 144, 144, 144, 144, 144, 175, 175, 144, 144, 144, 144, 144]

    cache150 = [2023, 2025, 2027, 2034, 2035, 2043, 2047, 2049, 2066, 2067, 2107, 2110, 2111, 2142, 2143, 2155, 2207, 2223, 2279, 2281, 2290, 2291, 2299, 2306, 2307, 2311, 2322, 2323, 2326, 2327, 2329, 2343, 2345, 2370, 2371, 2375, 2401, 2411, 2425, 2430, 2431, 2463, 2498, 2499, 2526, 2527, 2539, 2543, 2553, 2601, 2614, 2615, 2631, 2697, 2702, 2703, 2713, 2729, 2735, 2751, 2754, 2755, 2759, 2779, 2809, 2812, 2813, 2814, 2815, 2843, 2847, 2857, 2873, 2919, 2927, 2942, 2943, 3007, 3035, 3038, 3039, 3041, 3051, 3052, 3053, 3054, 3065, 3071, 3074, 3075, 3079, 3081, 3097, 3100, 3101, 3102, 3105, 3126, 3127, 3161, 3166, 3167, 3175, 3199, 3201, 3214, 3215, 3231, 3233, 3241, 3311, 3330, 3331, 3335, 3369, 3385, 3390, 3391, 3484, 3485, 3486, 3563, 3567, 3602, 3603, 3617, 3638, 3639, 3643, 3646, 3647, 3673, 3678, 3679, 3695, 3705, 3711, 3745, 3748, 3749, 3750, 3753, 3790, 3791, 3809, 3815, 3823, 3830, 3831, 3902, 3903, 3922, 3923, 3943, 3947, 3999, 4009, 4011, 4046, 4047, 4050, 4051, 4054, 4055, 4068, 4069, 4070, 4071, 4075, 4086, 4087, 4094, 4095, 4098, 4099, 4103, 4105, 4127, 4129, 4132, 4133, 4134, 4139, 4169, 4214, 4215, 4219, 4220, 4221, 4222, 4223, 4233, 4255, 4265, 4271, 4284, 4285, 4286, 4310, 4311, 4321, 4327, 4347, 4359, 4379, 4391, 4414, 4415, 4441, 4446, 4447, 4491, 4511, 4513, 4521, 4539, 4543, 4551, 4553, 4558, 4559, 4562, 4563, 4577, 4580, 4581, 4582, 4585, 4591, 4598, 4599, 4607, 4612, 4613, 4614, 4619, 4622, 4623, 4644, 4645, 4646, 4652, 4653, 4654, 4657, 4658, 4659, 4686, 4687, 4689, 4690, 4691, 4713, 4735, 4740, 4741, 4742, 4747, 4750, 4751, 4763, 4795, 4799, 4802, 4803, 4822, 4823, 4839, 4843, 4847, 4850, 4851, 4857, 4860, 4861, 4862, 4891, 4897, 4905, 4926, 4927, 4935, 4967, 4987, 4993, 4996, 4997, 4998, 5003, 5052, 5053, 5054, 5078, 5079, 5086, 5087, 5097, 5106, 5107, 5167, 5202, 5203, 5228, 5229, 5230, 5257, 5262, 5263, 5345, 5351, 5359, 5394, 5395, 5401, 5404, 5405, 5406, 5425, 5426, 5427, 5433, 5449, 5458, 5459, 5465, 5470, 5471, 5473, 5479, 5502, 5503, 5505, 5508, 5509, 5510, 5515, 5518, 5519, 5543, 5558, 5559, 5567, 5611, 5618, 5619, 5624, 5625, 5626, 5628, 5629, 5630, 5631, 5673, 5679, 5686, 5687, 5691, 5694, 5695, 5713, 5714, 5715, 5723, 5735, 5739, 5746, 5747, 5761, 5769, 5799, 5803, 5838, 5839, 5854, 5855, 5884, 5885, 5886, 5915, 5919, 5921, 5929, 5999]
    cache150Sol = [157, 157, 157, 157, 157, 157, 157, 157, 157, 157, 157, 170, 170, 170, 170, 170, 170, 183, 152, 152, 152, 152, 152, 152, 152, 152, 183, 183, 152, 152, 152, 152, 152, 152, 152, 165, 165, 165, 165, 165, 165, 209, 178, 178, 178, 178, 178, 178, 178, 178, 178, 178, 191, 160, 160, 160, 160, 160, 160, 173, 160, 160, 160, 160, 160, 173, 173, 173, 160, 173, 173, 173, 173, 217, 173, 173, 173, 155, 155, 155, 155, 155, 155, 155, 155, 155, 155, 155, 155, 155, 155, 155, 186, 155, 155, 155, 155, 155, 155, 155, 168, 168, 199, 168, 168, 168, 168, 168, 168, 168, 168, 181, 181, 181, 181, 181, 181, 181, 181, 181, 181, 163, 194, 163, 163, 163, 163, 163, 163, 163, 163, 163, 163, 163, 207, 163, 238, 163, 176, 176, 176, 163, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 189, 189, 158, 189, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 158, 171, 189, 158, 158, 158, 158, 158, 158, 158, 158, 171, 171, 171, 158, 202, 202, 171, 171, 171, 171, 171, 171, 171, 171, 171, 184, 171, 215, 171, 171, 171, 184, 184, 184, 184, 153, 184, 184, 184, 184, 184, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 171, 153, 153, 153, 153, 153, 153, 153, 153, 153, 184, 184, 184, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 166, 166, 197, 166, 166, 166, 166, 166, 166, 166, 166, 166, 166, 166, 166, 166, 166, 166, 179, 166, 166, 210, 210, 197, 166, 166, 166, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 179, 192, 192, 161, 192, 192, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 192, 174, 174, 192, 161, 161, 161, 161, 161, 161, 205, 161, 161, 236, 161, 161, 161, 174, 161, 174, 174, 174, 161, 161, 205, 161, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 205, 174, 218, 218, 174, 174, 174, 174, 174, 174, 174, 187, 187, 187]



    maxSteps = 0
    steps = 0
    s="["
    ssteps="["
    for n in range(i,j+1):
        temp = n
        steps = 1
        if n<2001 and n in cache120:
            pos = cache120.index(n)
            steps = cache120Sol[pos]
            n = 1
        elif n<6001 and n>2000 and n in cache150:
            pos = cache150.index(n)
            steps = cache150Sol[pos]
            n = 1
        #else:
        #    pass
        while n>1:
            if n%2==0:
                n = int(n/2)
                steps += 1
            else:
                n = int(3*n+1)
                steps += 1
        #if temp>6000 and steps>180:
            #s = s+str(steps)+", "
            #ssteps = ssteps+str(temp)+", "
        if steps>maxSteps:
            maxSteps = steps
    #print(s)
    #print(ssteps)
    return maxSteps

# -------------
# collatz_print
# -------------


def collatz_print(w, i, j, v):
    """
    print three ints
    w a writer
    i the beginning of the range, inclusive
    j the end       of the range, inclusive
    v the max cycle length
    """
    w.write(str(i) + " " + str(j) + " " + str(v) + "\n")

# -------------
# collatz_solve
# -------------


def collatz_solve(r, w):
    """
    r a reader
    w a writer
    """

    for s in r:
        #if not s.strip() == "":
            #continue
        i, j = collatz_read(s)
        v = collatz_eval(i, j)
        collatz_print(w, i, j, v)
